{% extends "admin_base.html" %}
{% block title %}Staff Only{% endblock %}
{% block head %}
    {{ super() }}
    <link rel="stylesheet" type="text/css" href={{ url_for("static", filename="css/admin.css") }}>
    <script type="text/javascript" src={{ url_for("static", filename="js/user.js") }}></script>
{% endblock %}
{% block content %}
    <main>
        <!--由LoginForm組件渲染-->
    </main>
    <script type="text/babel">
        class LoginForm extends React.Component{
            state = {
                username:"",
                password:""
            }
            render(){
                return(
                    <div id="box">
                        <div id="logo">
                            <img src="../static/images/logo2.jpg" alt=""/>
                        </div>
                        <form method="post" onSubmit={this.handleSubmit}>
                            <label for="">帳號：</label>
                            <input type="text" name="username" id="username" value={this.state.username}
                                onChange={this.handleChange("username")}/><p/>
                            <label for="">密碼：</label>
                            <input type="password" name="password" id="password" value={this.state.password}
                                onChange={this.handleChange("password")}/><p/>
                            <input type="submit" value="登入"/>
                        </form>
                        <div className="flash">
                        
                        </div>
                    </div>
                )
            }
            handleChange=(dataType)=>{
                return(eObj=>{
                    // console.log(dataType);
                    // console.log(eObj.target.value);
                    this.setState({[dataType]:eObj.target.value});
                })
            }
            handleSubmit=(eObj)=>{
                eObj.preventDefault()
                const {username, password} = this.state
                if(username==="" || password===""){
                    alert("登入資料皆不得為空值")
                    return
                }
                const data = {username, password}
                let p = userRequest("post", data)
                p.then(resp=>{
                    if(resp.ok){
                        location.href = `${window.origin}/admin/board`
                    }else if(resp.error){
                        alert(resp.message)
                        location.reload()
                    }
                })
            }
        }
        addEventListener("load", ()=>{
            currentUserPromise.then(currentUser=>{
                // console.log(currentUser);
                if(currentUser==null){
                    ReactDOM.render(<LoginForm/>, document.querySelector("main"));
                }else{
                    location.href = `${window.origin}/admin/board`
                }                
            })
        })
    </script>
{% endblock %}